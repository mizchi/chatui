<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <script type="module" src="src/index.tsx"></script>
  <script>
    window.addEventListener('keydown', (ev) => {
      if (ev.ctrlKey && ev.key === 'Enter') _play(document.getElementById('textarea').value);
    });
    window._play = async (text) => {
      text ||= document.getElementById('textarea').value;
      const encodedText = encodeURIComponent(text);
      const query = await fetch(`http://localhost:50021/audio_query?speaker=1&text=${encodedText}`, {
        method: 'POST',
      }).then(res => res.json());
      const res = await fetch('http://localhost:50021/synthesis?speaker=1', {
        method: 'POST',
        body: JSON.stringify(query),
        mode: "cors",
        cache: "no-cache",
        headers: {
          "Content-Type": "application/json",
          "Accept": "audio/wav",
        },
      });
      try {
        const url = window.URL.createObjectURL(await res.blob())
        window.audio = new Audio();
        window.type = 'audio/wav';
        window.audio.src = url;
        await window.audio.play();
      } catch (error) {
        console.log(error);
      }
    }
  </script>
  <div id="root"></div>
</head>

<body>
  <div id="root"></div>
  <!-- <h1>Audio</h1> -->
  <!-- <textarea id="textarea" cols="30" rows="10"></textarea>
  <button onclick="_play()" style="display: block;">speak</button> -->
</body>

</html>